(function(e,t,o,i,s,d,n){'use strict';var r=e.extend(o.contextual,{strings:{open:t.t('Open'),close:t.t('Close')}});var c=n.getItem('Drupal.contextual.permissionsHash'),a=o.user.permissionsHash;if(c!==a){if(typeof a==='string'){i.chain(n).keys().each(function(e){if(e.substring(0,18)==='Drupal.contextual.'){n.removeItem(e)}})};n.setItem('Drupal.contextual.permissionsHash',a)};function l(n,c){var l=n.closest('.contextual-region'),a=t.contextual;n.html(c).addClass('contextual').prepend(t.theme('contextualTrigger'));var d='destination='+t.encodePath(o.path.currentPath);n.find('.contextual-links a').each(function(){var e=this.getAttribute('href'),t=(e.indexOf('?')===-1)?'?':'&';this.setAttribute('href',e+t+d)});var i=new a.StateModel({title:l.find('h2').eq(0).text().trim()});var s=e.extend({el:n,model:i},r);a.views.push({visual:new a.VisualView(s),aural:new a.AuralView(s),keyboard:new a.KeyboardView(s)});a.regionViews.push(new a.RegionView(e.extend({el:l,model:i},r)));a.collection.add(i);e(document).trigger('drupalContextualLinkAdded',{$el:n,$region:l,model:i});u(n)};function u(e){var t=e.parents('.contextual-region').eq(-1).find('.contextual');if(t.length===1){return};var r=t.eq(0).offset().top,o=t.eq(1).offset().top;if(r===o){var n=t.eq(1),i=0,a=n.find('.trigger');a.removeClass('visually-hidden');i=n.height();a.addClass('visually-hidden');n.css({top:n.position().top+i})}};t.behaviors.contextual={attach:function(a){var r=e(a),o=r.find('[data-contextual-id]').once('contextual-render');if(o.length===0){return};var u=[];o.each(function(){u.push(e(this).attr('data-contextual-id'))});var s=i.filter(u,function(e){var t=n.getItem('Drupal.contextual.'+e);if(t!==null){window.setTimeout(function(){l(r.find('[data-contextual-id="'+e+'"]'),t)});return!1};return!0});if(s.length>0){e.ajax({url:t.url('contextual/render'),type:'POST',data:{'ids[]':s},dataType:'json',success:function(e){i.each(e,function(e,t){n.setItem('Drupal.contextual.'+t,e);if(e.length>0){o=r.find('[data-contextual-id="'+t+'"]');for(var a=0;a<o.length;a++){l(o.eq(a),e)}}})}})}}};t.contextual={views:[],regionViews:[]};t.contextual.collection=new s.Collection([],{model:t.contextual.StateModel});t.theme.contextualTrigger=function(){return'<button class="trigger visually-hidden focusable" type="button"></button>'}})(jQuery,Drupal,drupalSettings,_,Backbone,window.JSON,window.sessionStorage);