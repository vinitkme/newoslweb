(function(e,t,i){'use strict';i.quickedit.EditorView=t.View.extend({initialize:function(e){this.fieldModel=e.fieldModel;this.listenTo(this.fieldModel,'change:state',this.stateChange)},remove:function(){this.setElement();t.View.prototype.remove.call(this)},getEditedElement:function(){return this.$el},getQuickEditUISettings:function(){return{padding:!1,unifiedToolbar:!1,fullWidthToolbar:!1,popup:!1}},stateChange:function(e,i){var t=e.previous('state'),a=i;switch(a){case'inactive':break;case'candidate':if(t==='invalid'){this.removeValidationErrors()};break;case'highlighted':break;case'activating':var r=function(e){e()};r(function(){e.set('state','active')});break;case'active':break;case'changed':break;case'saving':if(t==='invalid'){this.removeValidationErrors()};this.save();break;case'saved':break;case'invalid':this.showValidationErrors();break}},revert:function(){},save:function(){var a=this.fieldModel,o=this.model,r='quickedit_backstage-'+this.fieldModel.id.replace(/[\/\[\]\_\s]/g,'-');function n(i){var t=e('#'+r).find('form');t.find(':input[type!="hidden"][type!="submit"]:not(select)').not('[name$="\\[summary\\]"]').val(i);t.find('.quickedit-form-submit').trigger('click.quickedit')};var d={fieldID:this.fieldModel.get('fieldID'),$el:this.$el,nocssjs:!0,other_view_modes:a.findOtherViewModes(),reset:!this.fieldModel.get('entity').get('inTempStore')};var t=this;i.quickedit.util.form.load(d,function(s,l){var c=e(i.theme('quickeditBackstage',{id:r})).appendTo('body');var v=e(s).appendTo(c);v.prop('novalidate',!0);var f=v.find('.quickedit-form-submit');t.formSaveAjax=i.quickedit.util.form.ajaxifySaving(d,f);function u(){i.quickedit.util.form.unajaxifySaving(t.formSaveAjax);delete t.formSaveAjax;c.remove()};t.formSaveAjax.commands.quickeditFieldFormSaved=function(e,i,t){u();a.set('state','saved');a.set('htmlForOtherViewModes',i.other_view_modes);a.set('html',i.data)};t.formSaveAjax.commands.quickeditFieldFormValidationErrors=function(e,i,t){u();o.set('validationErrors',i.data);a.set('state','invalid')};t.formSaveAjax.commands.quickeditFieldForm=function(){};n(o.get('currentValue'))})},showValidationErrors:function(){var i=e('<div class="quickedit-validation-errors"></div>').append(this.model.get('validationErrors'));this.getEditedElement().addClass('quickedit-validation-error').after(i)},removeValidationErrors:function(){this.getEditedElement().removeClass('quickedit-validation-error').next('.quickedit-validation-errors').remove()}})}(jQuery,Backbone,Drupal));