(function(t,e,i){'use strict';var n=JSON.parse(localStorage.getItem('Drupal.tableDrag.showWeight'));e.behaviors.tableDrag={attach:function(n,i){function a(t,n){if(t.length){e.tableDrag[n]=new e.tableDrag(t[0],i.tableDrag[n])}};for(var r in i.tableDrag){if(i.tableDrag.hasOwnProperty(r)){a(t(n).find('#'+r).once('tabledrag'),r)}}}};e.tableDrag=function(i,r){var a=this,l=t(i);this.$table=t(i);this.table=i;this.tableSettings=r;this.dragObject=null;this.rowObject=null;this.oldRowElement=null;this.oldY=0;this.changed=!1;this.maxDepth=0;this.rtl=t(this.table).css('direction')==='rtl'?-1:1;this.striping=t(this.table).data('striping')===1;this.scrollSettings={amount:4,interval:50,trigger:70};this.scrollInterval=null;this.scrollY=0;this.windowHeight=0;this.indentEnabled=!1;for(var o in r){if(r.hasOwnProperty(o)){for(var s in r[o]){if(r[o].hasOwnProperty(s)){if(r[o][s].relationship==='parent'){this.indentEnabled=!0};if(r[o][s].limit>0){this.maxDepth=r[o][s].limit}}}}};if(this.indentEnabled){this.indentCount=1;var d=e.theme('tableDragIndentation'),h=t('<tr/>').addClass('draggable').appendTo(i),f=t('<td/>').appendTo(h).prepend(d).prepend(d),g=f.find('.js-indentation');this.indentAmount=g.get(1).offsetLeft-g.get(0).offsetLeft;h.remove()};l.find('> tr.draggable, > tbody > tr.draggable').each(function(){a.makeDraggable(this)});l.before(t('<button type="button" class="link tabledrag-toggle-weight"></button>').attr('title',e.t('Re-order rows by numerical weight instead of dragging.')).on('click',t.proxy(function(t){t.preventDefault();this.toggleColumns()},this)).wrap('<div class="tabledrag-toggle-weight-wrapper"></div>').parent());a.initColumns();t(document).on('touchmove',function(t){return a.dragRow(t.originalEvent.touches[0],a)});t(document).on('touchend',function(t){return a.dropRow(t.originalEvent.touches[0],a)});t(document).on('mousemove pointermove',function(t){return a.dragRow(t,a)});t(document).on('mouseup pointerup',function(t){return a.dropRow(t,a)});t(window).on('storage',t.proxy(function(t){if(t.originalEvent.key==='Drupal.tableDrag.showWeight'){n=JSON.parse(t.originalEvent.newValue);this.displayColumns(n)}},this))};e.tableDrag.prototype.initColumns=function(){var a=this.$table,s,i,r;for(var t in this.tableSettings){if(this.tableSettings.hasOwnProperty(t)){for(var e in this.tableSettings[t]){if(this.tableSettings[t].hasOwnProperty(e)){var o=a.find('.'+this.tableSettings[t][e].target).eq(0);if(o.length&&this.tableSettings[t][e].hidden){s=this.tableSettings[t][e].hidden;i=o.closest('td');break}}};if(s&&i[0]){r=i.parent().find('> td').index(i.get(0))+1;a.find('> thead > tr, > tbody > tr, > tr').each(this.addColspanClass(r))}}};this.displayColumns(n)};e.tableDrag.prototype.addColspanClass=function(e){return function(){var a=t(this),i=e,r=a.children(),n;r.each(function(t){if(t<i&&this.colSpan&&this.colSpan>1){i-=this.colSpan-1}});if(i>0){n=r.filter(':nth-child('+i+')');if(n[0].colSpan&&n[0].colSpan>1){n.addClass('tabledrag-has-colspan')}
else{n.addClass('tabledrag-hide')}}}};e.tableDrag.prototype.displayColumns=function(e){if(e){this.showColumns()}
else{this.hideColumns()};t('table').findOnce('tabledrag').trigger('columnschange',!!e)};e.tableDrag.prototype.toggleColumns=function(){n=!n;this.displayColumns(n);if(n){localStorage.setItem('Drupal.tableDrag.showWeight',n)}
else{localStorage.removeItem('Drupal.tableDrag.showWeight')}};e.tableDrag.prototype.hideColumns=function(){var n=t('table').findOnce('tabledrag');n.find('.tabledrag-hide').css('display','none');n.find('.tabledrag-handle').css('display','');n.find('.tabledrag-has-colspan').each(function(){this.colSpan=this.colSpan-1});t('.tabledrag-toggle-weight').text(e.t('Show row weights'))};e.tableDrag.prototype.showColumns=function(){var n=t('table').findOnce('tabledrag');n.find('.tabledrag-hide').css('display','');n.find('.tabledrag-handle').css('display','none');n.find('.tabledrag-has-colspan').each(function(){this.colSpan=this.colSpan+1});t('.tabledrag-toggle-weight').text(e.t('Hide row weights'))};e.tableDrag.prototype.rowSettings=function(e,n){var l=t(n).find('.'+e),i=this.tableSettings[e];for(var r in i){if(i.hasOwnProperty(r)){var s=i[r].target;if(l.is('.'+s)){var o={};for(var a in i[r]){if(i[r].hasOwnProperty(a)){o[a]=i[r][a]}};return o}}}};e.tableDrag.prototype.makeDraggable=function(n){var i=this,a=t(n);a.find('td:first-of-type').find('a').addClass('menu-item__link');var r=t('<a href="#" class="tabledrag-handle"><div class="handle">&nbsp;</div></a>').attr('title',e.t('Drag to re-order')),o=a.find('td:first-of-type').find('.js-indentation').eq(-1);if(o.length){o.after(r);i.indentCount=Math.max(a.find('.js-indentation').length,i.indentCount)}
else{a.find('td').eq(0).prepend(r)};r.on('mousedown touchstart pointerdown',function(t){t.preventDefault();if(t.originalEvent.type==='touchstart'){t=t.originalEvent.touches[0]};i.dragStart(t,i,n)});r.on('click',function(t){t.preventDefault()});r.on('focus',function(){i.safeBlur=!0});r.on('blur',function(t){if(i.rowObject&&i.safeBlur){i.dropRow(t,i)}});r.on('keydown',function(e){if(e.keyCode!==9&&!i.rowObject){i.rowObject=new i.row(n,'keyboard',i.indentEnabled,i.maxDepth,!0)};var d=!1,s;switch(e.keyCode){case 37:case 63234:d=!0;i.rowObject.indent(-1*i.rtl);break;case 38:case 63232:var o=t(i.rowObject.element).prev('tr:first-of-type');var a=o.get(0);while(a&&o.is(':hidden')){o=t(a).prev('tr:first-of-type');a=o.get(0)};if(a){i.safeBlur=!1;i.rowObject.direction='up';d=!0;if(t(n).is('.tabledrag-root')){s=0;while(a&&o.find('.js-indentation').length){o=t(a).prev('tr:first-of-type');a=o.get(0);s+=o.is(':hidden')?0:a.offsetHeight};if(a){i.rowObject.swap('before',a);window.scrollBy(0,-s)}}
else if(i.table.tBodies[0].rows[0]!==a||o.is('.draggable')){i.rowObject.swap('before',a);i.rowObject.interval=null;i.rowObject.indent(0);window.scrollBy(0,-parseInt(n.offsetHeight,10))};r.trigger('focus')};break;case 39:case 63235:d=!0;i.rowObject.indent(i.rtl);break;case 40:case 63233:var h=t(i.rowObject.group).eq(-1).next('tr:first-of-type');var l=h.get(0);while(l&&h.is(':hidden')){h=t(l).next('tr:first-of-type');l=h.get(0)};if(l){i.safeBlur=!1;i.rowObject.direction='down';d=!0;if(t(n).is('.tabledrag-root')){s=0;var g=new i.row(l,'keyboard',i.indentEnabled,i.maxDepth,!1);if(g){t(g.group).each(function(){s+=t(this).is(':hidden')?0:this.offsetHeight});var f=t(g.group).eq(-1).get(0);i.rowObject.swap('after',f);window.scrollBy(0,parseInt(s,10))}}
else{i.rowObject.swap('after',l);i.rowObject.interval=null;i.rowObject.indent(0);window.scrollBy(0,parseInt(n.offsetHeight,10))};r.trigger('focus')};break};if(i.rowObject&&i.rowObject.changed===!0){t(n).addClass('drag');if(i.oldRowElement){t(i.oldRowElement).removeClass('drag-previous')};i.oldRowElement=n;if(i.striping===!0){i.restripeTable()};i.onDrag()};if(d){return!1}});r.on('keypress',function(t){switch(t.keyCode){case 37:case 38:case 39:case 40:return!1}})};e.tableDrag.prototype.dragStart=function(e,n,i){n.dragObject={};n.dragObject.initOffset=n.getPointerOffset(i,e);n.dragObject.initPointerCoords=n.pointerCoords(e);if(n.indentEnabled){n.dragObject.indentPointerPos=n.dragObject.initPointerCoords};if(n.rowObject){t(n.rowObject.element).find('a.tabledrag-handle').trigger('blur')};n.rowObject=new n.row(i,'pointer',n.indentEnabled,n.maxDepth,!0);n.table.topY=t(n.table).offset().top;n.table.bottomY=n.table.topY+n.table.offsetHeight;t(i).addClass('drag');t('body').addClass('drag');if(n.oldRowElement){t(n.oldRowElement).removeClass('drag-previous')}};e.tableDrag.prototype.dragRow=function(e,t){if(t.dragObject){t.currentPointerCoords=t.pointerCoords(e);var n=t.currentPointerCoords.y-t.dragObject.initOffset.y,a=t.currentPointerCoords.x-t.dragObject.initOffset.x;if(n!==t.oldY){t.rowObject.direction=n>t.oldY?'down':'up';t.oldY=n;var i=t.checkScroll(t.currentPointerCoords.y);clearInterval(t.scrollInterval);if(i>0&&t.rowObject.direction==='down'||i<0&&t.rowObject.direction==='up'){t.setScroll(i)};var r=t.findDropTargetRow(a,n);if(r){if(t.rowObject.direction==='down'){t.rowObject.swap('after',r,t)}
else{t.rowObject.swap('before',r,t)};if(t.striping===!0){t.restripeTable()}}};if(t.indentEnabled){var s=t.currentPointerCoords.x-t.dragObject.indentPointerPos.x,l=Math.round(s/t.indentAmount),o=t.rowObject.indent(l);t.dragObject.indentPointerPos.x+=t.indentAmount*o*t.rtl;t.indentCount=Math.max(t.indentCount,t.rowObject.indents)};return!1}};e.tableDrag.prototype.dropRow=function(n,i){var r,s;if(i.rowObject!==null){r=i.rowObject.element;s=t(r);if(i.rowObject.changed===!0){i.updateFields(r);for(var a in i.tableSettings){if(i.tableSettings.hasOwnProperty(a)){var l=i.rowSettings(a,r);if(l.relationship==='group'){for(var o in i.rowObject.children){if(i.rowObject.children.hasOwnProperty(o)){i.updateField(i.rowObject.children[o],a)}}}}};i.rowObject.markChanged();if(i.changed===!1){t(e.theme('tableDragChangedWarning')).insertBefore(i.table).hide().fadeIn('slow');i.changed=!0}};if(i.indentEnabled){i.rowObject.removeIndentClasses()};if(i.oldRowElement){t(i.oldRowElement).removeClass('drag-previous')};s.removeClass('drag').addClass('drag-previous');i.oldRowElement=r;i.onDrop();i.rowObject=null};if(i.dragObject!==null){i.dragObject=null;t('body').removeClass('drag');clearInterval(i.scrollInterval)}};e.tableDrag.prototype.pointerCoords=function(t){if(t.pageX||t.pageY){return{x:t.pageX,y:t.pageY}};return{x:t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.clientY+document.body.scrollTop-document.body.clientTop}};e.tableDrag.prototype.getPointerOffset=function(e,n){var r=t(e).offset(),i=this.pointerCoords(n);return{x:i.x-r.left,y:i.y-r.top}};e.tableDrag.prototype.findDropTargetRow=function(e,n){var s=t(this.table.tBodies[0].rows).not(':hidden');for(var a=0;a<s.length;a++){var i=s[a],r=t(i),l=r.offset().top,o;if(i.offsetHeight===0){o=parseInt(i.firstChild.offsetHeight,10)/2}
else{o=parseInt(i.offsetHeight,10)/2};if((n>(l-o))&&(n<(l+o))){if(this.indentEnabled){for(a in this.rowObject.group){if(this.rowObject.group[a]===i){return null}}}
else{if(i===this.rowObject.element){return null}};if(!this.rowObject.isValidSwap(i)){return null}
while(r.is(':hidden')&&r.prev('tr').is(':hidden')){r=r.prev('tr:first-of-type');i=r.get(0)};return i}};return null};e.tableDrag.prototype.updateFields=function(t){for(var e in this.tableSettings){if(this.tableSettings.hasOwnProperty(e)){this.updateField(t,e)}}};e.tableDrag.prototype.updateField=function(e,n){var a=this.rowSettings(n,e),o=t(e),r,i,d,c;if(a.relationship==='self'||a.relationship==='group'){r=e}
else if(a.relationship==='sibling'){i=o.prev('tr:first-of-type');d=i.get(0);var h=o.next('tr:first-of-type'),b=h.get(0);r=e;if(i.is('.draggable')&&i.find('.'+n).length){if(this.indentEnabled){if(i.find('.js-indentations').length===o.find('.js-indentations').length){r=d}}
else{r=d}}
else if(h.is('.draggable')&&h.find('.'+n).length){if(this.indentEnabled){if(h.find('.js-indentations').length===o.find('.js-indentations').length){r=b}}
else{r=b}}}
else if(a.relationship==='parent'){i=o.prev('tr');d=i;while(i.length&&i.find('.js-indentation').length>=this.rowObject.indents){i=i.prev('tr');d=i};if(i.length){r=i.get(0)}
else{r=t(this.table).find('tr.draggable:first-of-type').get(0);if(r===this.rowObject.element){r=t(this.rowObject.group[this.rowObject.group.length-1]).next('tr.draggable').get(0)};c=!0}};this.copyDragClasses(r,e,n);a=this.rowSettings(n,e);if(c){a.relationship='sibling';a.source=a.target};var g='.'+a.target,s=o.find(g).get(0);if(s){var w='.'+a.source,u=t(w,r).get(0);switch(a.action){case'depth':s.value=t(u).closest('tr').find('.js-indentation').length;break;case'match':s.value=u.value;break;case'order':var f=this.rowObject.findSiblings(a);if(t(s).is('select')){var l=[];t(s).find('option').each(function(){l.push(this.value)});var v=l[l.length-1];t(f).find(g).each(function(){if(l.length>0){this.value=l.shift()}
else{this.value=v}})}
else{var p=parseInt(t(f[0]).find(g).val(),10)||0;t(f).find(g).each(function(){this.value=p;p++})};break}}};e.tableDrag.prototype.copyDragClasses=function(e,n,i){var a=t(e).find('.'+i),r=t(n).find('.'+i);if(a.length&&r.length){r[0].className=a[0].className}};e.tableDrag.prototype.checkScroll=function(t){var r=document.documentElement,a=document.body,o=this.windowHeight=window.innerHeight||(r.clientHeight&&r.clientWidth!==0?r.clientHeight:a.offsetHeight),i;if(document.all){i=this.scrollY=!r.scrollTop?a.scrollTop:r.scrollTop}
else{i=this.scrollY=window.pageYOffset?window.pageYOffset:window.scrollY};var n=this.scrollSettings.trigger,e=0;if(t-i>o-n){e=n/(o+i-t);e=(e>0&&e<n)?e:n;return e*this.scrollSettings.amount}
else if(t-i<n){e=n/(t-i);e=(e>0&&e<n)?e:n;return-e*this.scrollSettings.amount}};e.tableDrag.prototype.setScroll=function(t){var e=this;this.scrollInterval=setInterval(function(){e.checkScroll(e.currentPointerCoords.y);var i=e.scrollY>e.table.topY,n=e.scrollY+e.windowHeight<e.table.bottomY;if(t>0&&n||t<0&&i){window.scrollBy(0,t)}},this.scrollSettings.interval)};e.tableDrag.prototype.restripeTable=function(){t(this.table).find('> tbody > tr.draggable:visible, > tr.draggable:visible').removeClass('odd even').filter(':odd').addClass('even').end().filter(':even').addClass('odd')};e.tableDrag.prototype.onDrag=function(){return null};e.tableDrag.prototype.onDrop=function(){return null};e.tableDrag.prototype.row=function(e,n,i,o,s){var r=t(e);this.element=e;this.method=n;this.group=[e];this.groupDepth=r.find('.js-indentation').length;this.changed=!1;this.table=r.closest('table')[0];this.indentEnabled=i;this.maxDepth=o;this.direction='';if(this.indentEnabled){this.indents=r.find('.js-indentation').length;this.children=this.findChildren(s);this.group=t.merge(this.group,this.children);for(var a=0;a<this.group.length;a++){this.groupDepth=Math.max(t(this.group[a]).find('.js-indentation').length,this.groupDepth)}}};e.tableDrag.prototype.row.prototype.findChildren=function(e){var i=this.indents,n=t(this.element,this.table).next('tr.draggable'),r=[],a=0;function o(e,n){var r=t(n);if(a===1&&(e===i)){r.addClass('tree-child-first')};if(e===i){r.addClass('tree-child')}
else if(e>i){r.addClass('tree-child-horizontal')}}
while(n.length){if(n.find('.js-indentation').length>i){a++;r.push(n[0]);if(e){n.find('.js-indentation').each(o)}}
else{break};n=n.next('tr.draggable')};if(e&&r.length){t(r[r.length-1]).find('.js-indentation:nth-child('+(i+1)+')').addClass('tree-child-last')};return r};e.tableDrag.prototype.row.prototype.isValidSwap=function(e){var n=t(e);if(this.indentEnabled){var i,r;if(this.direction==='down'){i=e;r=n.next('tr').get(0)}
else{i=n.prev('tr').get(0);r=e};this.interval=this.validIndentInterval(i,r);if(this.interval.min>this.interval.max){return!1}};if(this.table.tBodies[0].rows[0]===e&&n.is(':not(.draggable)')){return!1};return!0};e.tableDrag.prototype.row.prototype.swap=function(n,r){this.group.forEach(function(t){e.detachBehaviors(t,i,'move')});t(r)[n](this.group);this.group.forEach(function(t){e.attachBehaviors(t,i)});this.changed=!0;this.onSwap(r)};e.tableDrag.prototype.row.prototype.validIndentInterval=function(e,n){var r=t(e),a,i;a=n?t(n).find('.js-indentation').length:0;if(!e||r.is(':not(.draggable)')||t(this.element).is('.tabledrag-root')){i=0}
else{i=r.find('.js-indentation').length+(r.is('.tabledrag-leaf')?0:1);if(this.maxDepth){i=Math.min(i,this.maxDepth-(this.groupDepth-this.indents))}};return{min:a,max:i}};e.tableDrag.prototype.row.prototype.indent=function(n){var r=t(this.group);if(!this.interval){var o=t(this.element).prev('tr').get(0),s=r.eq(-1).next('tr').get(0);this.interval=this.validIndentInterval(o,s)};var i=this.indents+n;i=Math.max(i,this.interval.min);i=Math.min(i,this.interval.max);n=i-this.indents;for(var a=1;a<=Math.abs(n);a++){if(n<0){r.find('.js-indentation:first-of-type').remove();this.indents--}
else{r.find('td:first-of-type').prepend(e.theme('tableDragIndentation'));this.indents++}};if(n){this.changed=!0;this.groupDepth+=n;this.onIndent()};return n};e.tableDrag.prototype.row.prototype.findSiblings=function(e){var a=[],r=['prev','next'],s=this.indents,o;for(var i=0;i<r.length;i++){var n=t(this.element)[r[i]]();while(n.length){if(n.find('.'+e.target)){if(this.indentEnabled){o=n.find('.js-indentation').length};if(!(this.indentEnabled)||(o===s)){a.push(n[0])}
else if(o<s){break}}
else{break};n=n[r[i]]()};if(r[i]==='prev'){a.reverse();a.push(this.element)}};return a};e.tableDrag.prototype.row.prototype.removeIndentClasses=function(){for(var e in this.children){if(this.children.hasOwnProperty(e)){t(this.children[e]).find('.js-indentation').removeClass('tree-child').removeClass('tree-child-first').removeClass('tree-child-last').removeClass('tree-child-horizontal')}}};e.tableDrag.prototype.row.prototype.markChanged=function(){var i=e.theme('tableDragChangedMarker'),n=t(this.element).find('td:first-of-type');if(n.find('abbr.tabledrag-changed').length===0){n.append(i)}};e.tableDrag.prototype.row.prototype.onIndent=function(){return null};e.tableDrag.prototype.row.prototype.onSwap=function(t){return null};t.extend(e.theme,{tableDragChangedMarker:function(){return'<abbr class="warning tabledrag-changed" title="'+e.t('Changed')+'">*</abbr>'},tableDragIndentation:function(){return'<div class="js-indentation indentation">&nbsp;</div>'},tableDragChangedWarning:function(){return'<div class="tabledrag-changed-warning messages messages--warning" role="alert">'+e.theme('tableDragChangedMarker')+' '+e.t('You have unsaved changes.')+'</div>'}})})(jQuery,Drupal,drupalSettings);