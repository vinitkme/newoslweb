(function(e,i,t){'use strict';i.quickedit.editors.form=i.quickedit.EditorView.extend({$formContainer:null,formSaveAjax:null,stateChange:function(i,e){var t=i.previous('state'),a=e;switch(a){case'inactive':break;case'candidate':if(t!=='inactive'){this.removeForm()};break;case'highlighted':break;case'activating':if(t!=='invalid'){this.loadForm()};break;case'active':break;case'changed':break;case'saving':this.save();break;case'saved':break;case'invalid':this.showValidationErrors();break}},getQuickEditUISettings:function(){return{padding:!0,unifiedToolbar:!0,fullWidthToolbar:!0,popup:!0}},loadForm:function(){var t=this.fieldModel,o='quickedit-form-for-'+t.id.replace(/[\/\[\]]/g,'_'),a=this.$formContainer=e(i.theme('quickeditFormContainer',{id:o,loadingMsg:i.t('Loadingâ€¦')}));a.find('.quickedit-form').addClass('quickedit-editable quickedit-highlighted quickedit-editing').attr('role','dialog');if(this.$el.css('display')==='inline'){a.prependTo(this.$el.offsetParent());var r=this.$el.position();a.css('left',r.left).css('top',r.top)}
else{a.insertBefore(this.$el)};var n={fieldID:t.get('fieldID'),$el:this.$el,nocssjs:!1,reset:!t.get('entity').get('inTempStore')};i.quickedit.util.form.load(n,function(e,r){i.AjaxCommands.prototype.insert(r,{data:e,selector:'#'+o+' .placeholder'});a.on('formUpdated.quickedit',':input',function(i){var e=t.get('state');if(e==='invalid'){t.set('state','activating')}
else{t.set('state','changed')}}).on('keypress.quickedit','input',function(i){if(i.keyCode===13){return!1}});t.set('state','active')})},removeForm:function(){if(this.$formContainer===null){return};delete this.formSaveAjax;i.detachBehaviors(this.$formContainer.get(0),null,'unload');this.$formContainer.off('change.quickedit',':input').off('keypress.quickedit','input').remove();this.$formContainer=null},save:function(){var r=this.$formContainer,o=r.find('.quickedit-form-submit'),s=this.model,e=this.fieldModel;function n(){i.quickedit.util.form.unajaxifySaving(a);a=null};var a=i.quickedit.util.form.ajaxifySaving({nocssjs:!1,other_view_modes:e.findOtherViewModes()},o);a.commands.quickeditFieldFormSaved=function(i,a,o){n();e.set('state','saved');e.set('htmlForOtherViewModes',a.other_view_modes);t.defer(function(){e.set('html',a.data)})};a.commands.quickeditFieldFormValidationErrors=function(i,t,a){s.set('validationErrors',t.data);e.set('state','invalid')};a.commands.quickeditFieldForm=function(e,t,a){i.AjaxCommands.prototype.insert(e,{data:t.data,selector:'#'+r.attr('id')+' form'})};o.trigger('click.quickedit')},showValidationErrors:function(){this.$formContainer.find('.quickedit-form').addClass('quickedit-validation-error').find('form').prepend(this.model.get('validationErrors'))}})})(jQuery,Drupal,_);